//go:build exclude

// cve-info.go: Get information about CVE from NVD API.
//
// 
package main

import (
  "encoding/json"
  "fmt"
  "log"
  "os"
  "pmdn.org/nvd-go/cve"
  "pmdn.org/nvd-go/nvd-api"
)

func main() {
  // get api key from environment variable
  apiKey := os.Getenv("NVD_API_KEY")
  if apiKey == "" {
    log.Fatal("Missing environment variable: NVD_API_KEY")
  }

  // get search string
  numArgs := len(os.Args)
  if numArgs < 2 {
    // get app name
    appName := "cve-search"
    if numArgs > 0 {
      appName = os.Args[0]
    }

    log.Fatalf("Usage: %s <CVE ID>", appName)
  }

  // build cve search parameters
  params := nvd_api.CveParams {
    ResultsPerPage: 10, // first 10 results
    CveId: cve.MustParseId(os.Args[1]), // CVE ID
  }

  // create client
  client := nvd_api.NewClient(apiKey)

  // search cves
  r, err := client.Cves(params)
  if err != nil {
    log.Fatal(fmt.Errorf("Cves(): %w", err))
  }

  // encode as json, write to stdout
  if err := json.NewEncoder(os.Stdout).Encode(r); err != nil {
    log.Fatal(fmt.Errorf("Encode(): %w", err))
  }
}
